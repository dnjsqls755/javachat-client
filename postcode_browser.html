<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>주소 검색</title>
    <style>
        body { margin: 0; padding: 20px; font-family: '맑은 고딕', sans-serif; }
        #info { padding: 20px; background: #f0f0f0; border-radius: 8px; margin-bottom: 20px; }
        h2 { margin-top: 0; color: #333; }
        p { color: #666; }
        #wrap { position: relative; width: 100%; height: 600px; }
    </style>
    <script>
        // Deprecated 경고 억제
        const originalWarn = console.warn;
        console.warn = function(...args) {
            if (args[0] && typeof args[0] === 'string' && 
                (args[0].includes('Unload event') || args[0].includes('deprecated'))) {
                return;
            }
            originalWarn.apply(console, args);
        };
    </script>
</head>
<body>
    <div id="info">
        <h2>우편번호 검색</h2>
        <p>주소를 검색하고 선택하면 자동으로 회원가입 화면에 입력됩니다.</p>
    </div>
    <div id="wrap"></div>
    
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        new daum.Postcode({
            oncomplete: function(data) {
                var fullAddr = data.address;
                if(data.addressType === 'R'){
                    if(data.bname !== ''){
                        fullAddr += ' (' + data.bname;
                    }
                    if(data.buildingName !== ''){
                        fullAddr += (data.bname !== '' ? ', ' : '(') + data.buildingName;
                    }
                    if(data.bname !== '' || data.buildingName !== ''){
                        fullAddr += ')';
                    }
                }
                
                // 현재 페이지의 포트를 사용 (동적 포트 지원)
                var serverPort = window.location.port || '8888';
                var serverUrl = "http://localhost:" + serverPort + "/address";
                
                // 클라이언트 HTTP 서버로 POST 요청
                fetch(serverUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ postal: data.zonecode, address: fullAddr })
                }).then(function(response) {
                    console.log('주소 전송 완료');
                    
                    // 안내 메시지 표시
                    document.getElementById('info').innerHTML = 
                        '<h2 style="color: green;">✓ 주소 선택 완료!</h2>' +
                        '<p><b>우편번호:</b> ' + data.zonecode + '</p>' +
                        '<p><b>주소:</b> ' + fullAddr + '</p>' +
                        '<p style="color: green; font-size: 16px; font-weight: bold;">회원가입 화면에 자동으로 입력됩니다.</p>' +
                        '<p style="color: #666;">이 창을 닫으셔도 됩니다.</p>';
                    
                    document.getElementById('wrap').style.display = 'none';
                }).catch(function(error) {
                    console.error('주소 전송 실패:', error);
                    alert('주소 전송 오류: ' + error);
                });
            },
            shorthand: false,
            hideMapBtn: true,
            hideEngBtn: true,
            alwaysShowEngAddr: false,
            width: '100%',
            height: '100%'
        }).embed(document.getElementById('wrap'));
    </script>
</body>
</html>
